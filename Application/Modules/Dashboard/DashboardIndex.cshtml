@{
    ViewData["Title"] = "Dashboard";
    ViewData["PageId"] = "Dashboard";
}

@section Head {
    @Html.StyleBundle("Pages/Dashboard")
    @Html.ScriptBundle("Pages/Dashboard")

    <link rel="stylesheet" href="~/Scripts/jvectormap/jquery-jvectormap-1.2.2.css">
    <script src="~/Scripts/sparkline/jquery.sparkline.min.js"></script>
    <script src="~/Scripts/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="~/Scripts/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="~/Scripts/chartjs/Chart.min.js"></script>
    <script src="~/Scripts/adminlte/pages/dashboard2.js"></script>
    <script src="~/Scripts/adminlte/demo.js"></script>
}

@section ContentHeader {
   
}

<script type="text/javascript">
    var box;
    var report;
    var order;

    function intialize() {

        box = new Vue({
            el: '#dashboardBox',
            data: {
                boxData: '',
                timer: ''

            },
            created() {
                this.fetchData();
                this.timer = setInterval(this.fetchData, 1000 * 30);

            },
            methods: {
                fetchData() {
                    $.get('/Services/Dashboard/Repository/GetBoxData').then(response => {
                        this.boxData = response;
                    });
                }
            },
            beforeDestroy() {
                clearInterval(this.timer);
            }

        });

        order = new Vue({
            el: '#dashboardOrders',
            data: {
                soData: '',
                poData: '',
                projectData: '',
                timer: ''
            },

            created() {
                this.fetchData();
                this.timer = setInterval(this.fetchData, 1000 * 30);
            },
            methods: {
                fetchData() {
                    $.get('/Services/Dashboard/Repository/GetOrderData').then(response => {
                        this.soData = response.SalesOrder;
                        this.poData = response.PurchaseOrder;
                        this.projectData = response.Project;
                    });
                },
                onClickSalesOrder(orderNo) {
                    var dlg = new Matrix.Sales.SalesOrderDialog();
                    dlg.loadByIdAndOpenDialog(orderNo);
                },
                onClickPurchaseOrder(orderNo) {
                    var dlg = new Matrix.Purchasing.PurchaseOrderDialog();
                    dlg.loadByIdAndOpenDialog(orderNo);
                }
            },
            beforeDestroy() {
                clearInterval(this.timer);
            }
        });

        order = new Vue({
            el: '#dashboradReport',
            data: {
                rptData: '',
                timer: ''

            },
            created() {
                this.fetchData();
                this.timer = setInterval(this.fetchData, 1000 * 30);
            },
            methods: {
                fetchData() {
                    $.get('/Services/Dashboard/Repository/GetReportData').then(response => {
                        this.rptData = response;
                        this.initializeChart(response.Graph);
                        console.log("response", response);
                    });
                },

                initializeChart(data) {
                    console.log("initializeChart data", data);

                    var salesChartCanvas = $("#salesChart").get(0).getContext("2d");
                    var salesChart = new Chart(salesChartCanvas);
                    var period = [];
                    var ap = [];
                    var ar = [];

                    jQuery.each(data, function (i, val) {
                        period.push(val.Period);
                        ap.push(val.DebitRatio);
                        a.push(val.CreditRatio);
                    });

                    var salesChartData = {
                        labels: period,
                        datasets: [
                            {
                                label: "AP",
                                fillColor: "rgb(210, 214, 222)",
                                strokeColor: "rgb(210, 214, 222)",
                                pointColor: "rgb(210, 214, 222)",
                                pointStrokeColor: "#c1c7d1",
                                pointHighlightFill: "#fff",
                                pointHighlightStroke: "rgb(220,220,220)",
                                data: ap
                            },
                            {
                                label: "AR",
                                fillColor: "rgba(60,141,188,0.9)",
                                strokeColor: "rgba(60,141,188,0.8)",
                                pointColor: "#3b8bba",
                                pointStrokeColor: "rgba(60,141,188,1)",
                                pointHighlightFill: "#fff",
                                pointHighlightStroke: "rgba(60,141,188,1)",
                                data: ar
                            }
                        ]
                    };

                    var salesChartOptions = {
                        //Boolean - If we should show the scale at all
                        showScale: true,
                        //Boolean - Whether grid lines are shown across the chart
                        scaleShowGridLines: false,
                        //String - Colour of the grid lines
                        scaleGridLineColor: "rgba(0,0,0,.05)",
                        //Number - Width of the grid lines
                        scaleGridLineWidth: 1,
                        //Boolean - Whether to show horizontal lines (except X axis)
                        scaleShowHorizontalLines: true,
                        //Boolean - Whether to show vertical lines (except Y axis)
                        scaleShowVerticalLines: true,
                        //Boolean - Whether the line is curved between points
                        bezierCurve: true,
                        //Number - Tension of the bezier curve between points
                        bezierCurveTension: 0.3,
                        //Boolean - Whether to show a dot for each point
                        pointDot: false,
                        //Number - Radius of each point dot in pixels
                        pointDotRadius: 4,
                        //Number - Pixel width of point dot stroke
                        pointDotStrokeWidth: 1,
                        //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
                        pointHitDetectionRadius: 20,
                        //Boolean - Whether to show a stroke for datasets
                        datasetStroke: true,
                        //Number - Pixel width of dataset stroke
                        datasetStrokeWidth: 2,
                        //Boolean - Whether to fill the dataset with a color
                        datasetFill: true,
                        //String - A legend template
                        legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%=datasets[i].label%></li><%}%></ul>",
                        //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
                        maintainAspectRatio: true,
                        //Boolean - whether to make the chart responsive to window resizing
                        responsive: true
                    };

                    salesChart.Line(salesChartData, salesChartOptions);

                }
            },
            beforeDestroy() {
                clearInterval(this.timer);
            }
        });
    }

    jQuery(function () {
        
        intialize();

    });
</script>

<div class="row"  id="dashboardBox">
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-aqua">
            <div class="inner">
                <h3>{{boxData.SalesOrderCount}}</h3>
                <p>Sales Orders</p>
            </div>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-green">
            <div class="inner">
                <h3>{{boxData.PurchaseOrderCount}}</h3>
                <p>Purchase Orders</p>
            </div>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>{{boxData.JobOrderCount}}</h3>
                <p>Job Order</p>
            </div>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-teal">
            <div class="inner">
                <h3>{{boxData.WorkCompletionCount}}</h3>
                <p>Work Completion</p>
            </div>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-red">
            <div class="inner">
                <h3>{{boxData.AmountPaied}}</h3>
                <p>Account Payable</p>
            </div>
        </div>
    </div><!-- ./col -->
    <div class="col-lg-2 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-purple">
            <div class="inner">
                <h3>{{boxData.AmountReceived}}</h3>
                <p>Account Receivable</p>
            </div>
        </div>
    </div><!-- ./col -->
</div>

<div class="row" id="dashboradReport">
    <div class="col-md-12">
        <div class="box">
            <div class="box-header with-border">
                <h3 class="box-title">Monthly Recap Report (@ViewBag.PeriodNo)</h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <div class="btn-group">
                        <button class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown"><i class="fa fa-wrench"></i></button>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </div>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                </div>
            </div><!-- /.box-header -->
            <div class="box-body">
                <div class="row">
                    <div class="col-md-8">
                        <p class="text-center">
                            <strong>Enterprise Solution Limited</strong>
                        </p>
                        <div class="chart">
                            <!-- Sales Chart Canvas -->
                            <canvas id="salesChart" style="height: 180px;"></canvas>
                        </div><!-- /.chart-responsive -->
                    </div><!-- /.col -->
                    <div class="col-md-4">
                        <p class="text-center">
                            <strong>Goal Completion</strong>
                        </p>
                        <div class="progress-group">
                            <span class="progress-text">Add Products to Cart</span>
                            <span class="progress-number"><b>160</b>/200</span>
                            <div class="progress sm">
                                <div class="progress-bar progress-bar-aqua" style="width: 80%"></div>
                            </div>
                        </div><!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">Complete Purchase</span>
                            <span class="progress-number"><b>310</b>/400</span>
                            <div class="progress sm">
                                <div class="progress-bar progress-bar-red" style="width: 80%"></div>
                            </div>
                        </div><!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">Visit Premium Page</span>
                            <span class="progress-number"><b>480</b>/800</span>
                            <div class="progress sm">
                                <div class="progress-bar progress-bar-green" style="width: 80%"></div>
                            </div>
                        </div><!-- /.progress-group -->
                        <div class="progress-group">
                            <span class="progress-text">Send Inquiries</span>
                            <span class="progress-number"><b>250</b>/500</span>
                            <div class="progress sm">
                                <div class="progress-bar progress-bar-yellow" style="width: 80%"></div>
                            </div>
                        </div><!-- /.progress-group -->
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- ./box-body -->
            <div class="box-footer">
                <div class="row">
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 17%</span>
                            <h5 class="description-header">{{rptData.ValueBegin}} <i class="fa fa-cny"></i> </h5>
                            <span class="description-text">TOTAL Begin</span>
                        </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-yellow"><i class="fa fa-caret-left"></i> 0%</span>
                            <h5 class="description-header">{{rptData.DebitCredit}} <i class="fa fa-cny"></i></h5>
                            <span class="description-text">TOTAL Transaction</span>
                        </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block border-right">
                            <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 20%</span>
                            <h5 class="description-header">+{{rptData.InventoryLedgerIn}}-{{rptData.InventoryLedgerOut}} <i class="fa fa-cny"></i></h5>
                            <span class="description-text">INVENTORY COST</span>
                        </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                        <div class="description-block">
                            <span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 18%</span>
                            <h5 class="description-header">1200</h5>
                            <span class="description-text">GOAL COMPLETIONS</span>
                        </div><!-- /.description-block -->
                    </div>
                </div><!-- /.row -->
            </div><!-- /.box-footer -->
        </div><!-- /.box -->
    </div><!-- /.col -->
</div>

<div class="row" id="dashboardOrders">
    <!-- Left col -->
    <div class="col-md-8">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">Latest Orders</h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                </div>
            </div><!-- /.box-header -->
            <div class="box-body">
                <ul class="nav nav-tabs pull-right">
                    <li class="active"><a href="#revenue-chartX" data-toggle="tab">Sales</a></li>
                    <li><a href="#sales-chartX" data-toggle="tab">Purchasing</a></li>
                </ul>
                <div class="tab-content no-padding">
                    <!-- Morris chart - Sales -->
                    <div class="chart tab-pane active" id="revenue-chartX" style="position: relative; height: 180px;">
                        <div class="table-responsive">
                            <table class="table no-margin">
                                <thead>
                                    <tr>
                                        <th>SO #</th>
                                        <th>Customer</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in soData">
                                        <td><a v-on:click="onClickSalesOrder(item.OrderNo)"> {{item.OrderNo}}</a></td>
                                        <td>{{item.Vendor}}</td>
                                        <td><span class="label label-success">{{item.Status}}</span></td>
                                        <td>{{item.OrderDate}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div><!-- /.table-responsive -->
                    </div>
                    <div class="chart tab-pane" id="sales-chartX" style="position: relative; height: 180px;">
                        <div class="table-responsive">
                            <table class="table no-margin">
                                <thead>
                                    <tr>
                                        <th>PO #</th>
                                        <th>Vendor</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in poData">
                                    <td><a v-on:click="onClickPurchaseOrder(item.OrderNo)">{{item.OrderNo}}</a></td>
                                    <td>{{item.Vendor}}</td>
                                    <td><span class="label label-success">{{item.Status}}</span></td>
                                    <td>{{item.OrderDate}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div><!-- /.table-responsive -->
                    </div>
                </div>

            </div><!-- /.box-body -->
           
        </div><!-- /.box -->
    </div><!-- /.col -->

    <div class="col-md-4">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">Recently Projects</h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                </div>
            </div><!-- /.box-header -->
            <div class="box-body">
                <ul class="products-list product-list-in-box">
                    <li class="item" v-for="item in projectData">
                        <div class="product-img">
                            <img src="~/Content/adminlte/img/default-50x50.gif" alt="Product Image">
                        </div>
                        <div class="product-info">
                            <a href="javascript::;" class="product-title">{{item.ProjectName}}<span class="label label-warning pull-right">{{item.EstimatedAmount}}</span></a>
                            <span class="product-description">
                                {{item.Description}}
                            </span>
                        </div>
                    </li><!-- /.item -->
                </ul>
            </div><!-- /.box-body -->
        </div><!-- /.box -->
    </div><!-- /.col -->
</div>